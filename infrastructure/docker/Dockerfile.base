FROM python:3.11-slim

WORKDIR /app

RUN pip install --no-cache-dir --upgrade pip setuptools wheel

# نصب ابزار runtime مشترک
RUN pip install --no-cache-dir \
    uvicorn \
    requests

# کپی shared kernel
COPY backend/shared /app/backend/shared

# نصب shared kernel به‌صورت پکیج
RUN pip install -e /app/backend/shared
