networks:
  sfs_net:

volumes:
  postgres_data:

services:

  # -----------------------
  # Base image (Shared Kernel)
  # -----------------------
  base:
    image: sfs_base:latest
    build:
      context: ../..
      dockerfile: infrastructure/docker/Dockerfile.base
    networks:
      - sfs_net

  postgres:
    image: postgres:15
    container_name: sfs-postgres
    restart: always
    environment:
      POSTGRES_DB: sfs
      POSTGRES_USER: sfs
      POSTGRES_PASSWORD: sfs
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - sfs_net

  management:
    container_name: sfs-management
    build:
      context: ../..
      dockerfile: infrastructure/docker/management/Dockerfile
    depends_on:
      - base
      - postgres
    env_file:
      - ../env/management.env
    ports:
      - "8000:8000"
    networks:
      - sfs_net

  data_ingestion:
    container_name: sfs-data-ingestion
    build:
      context: ../..
      dockerfile: infrastructure/docker/data_ingestion/Dockerfile
    depends_on:
      - base
      - postgres
    env_file:
      - ../env/data_ingestion.env
    ports:
      - "8001:8001"
    networks:
      - sfs_net

  monitoring:
    container_name: sfs-monitoring
    build:
      context: ../..
      dockerfile: infrastructure/docker/monitoring/Dockerfile
    depends_on:
      - base
      - postgres
    env_file:
      - ../env/monitoring.env
    ports:
      - "8002:8002"
    networks:
      - sfs_net

  edge_controller:
    container_name: sfs-edge-controller
    build:
      context: ../..
      dockerfile: infrastructure/docker/edge_controller/Dockerfile
    depends_on:
      - base
      - postgres
    env_file:
      - ../env/edge_controller.env
    ports:
      - "8003:8003"
    networks:
      - sfs_net

  ai_decision:
    container_name: sfs-ai-decision
    build:
      context: ../..
      dockerfile: infrastructure/docker/ai_decision/Dockerfile
    depends_on:
      - base
      - postgres
    env_file:
      - ../env/ai_decision.env
    ports:
      - "8004:8004"
    networks:
      - sfs_net
